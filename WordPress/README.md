# Преодоление файла wp-config.php


Пакет WordPress (v3.4.1) содержит 981 файл и 95 папок. Ни один из этих файлов не требует ручной модификации, за исключением файла wp-config.php .

Конечно, нам не нужно редактировать файл, если у нас все в порядке с конфигурацией WordPress по умолчанию, но очень важно, чтобы мы узнали, как победить файл, чтобы применить меры безопасности, трюки со скоростью и другие вещи, которые мы будем изучать .

Перво-наперво: `резервное копирование!`

Лучше перестраховаться, чем сожалеть: создайте резервную копию своего контента прямо сейчас! Либо используйте встроенную страницу экспорта, либо используйте плагин, либо сделайте резервную копию из `phpMyAdmin`, но всегда имейте возможность отменить то, что вы сделали при настройке своего веб-сайта.

Операции могут повлиять на базу данных, но они ничего не сделают ни с одним из файлов, кроме файла, с которым мы собираемся работать, поэтому достаточно создать резервную копию файла `wp-config.php` ... но если вы не сделали резервную копию храните свои файлы более месяца, я предлагаю сделать это тоже. Частое резервное копирование всегда хорошо.


## Скорость: Отключить ревизии... Сейчас!

Функция ревизий для сообщений включена по умолчанию, но может привести к значительному раздуванию базы данных. Есть исправления, так что вы можете вернуться к предыдущей версии сообщения, если вам нужно. Если вы не планируете использовать ревизии для проверки «более ранних версий» ваших сообщений, вам определенно следует отключить эту функцию, добавив следующую строку в файл `wp-config.php` :

```
define('WP_POST_REVISIONS', false );
```
Однако, если у вас все в порядке с исправлениями, но вы не собираетесь получать неограниченное количество копий отредактированных сообщений, вы можете ограничить максимальное количество изменений для каждого сообщения с помощью этой строки кода:

```
define('WP_POST_REVISIONS', 2 );
```
Более 2 миллионов тем и плагинов WordPress, веб-шаблонов и шаблонов электронной почты, наборов пользовательского интерфейса и многого другого
Загрузите тысячи тем и плагинов WordPress, веб-шаблонов, элементов пользовательского интерфейса и многое другое с членством в Envato Elements. Получите неограниченный доступ к растущей библиотеке с миллионами творческих и кодовых ресурсов.


## Скорость: установить домен cookie
Если вы обслуживаете статический контент (т. е. ваши медиафайлы) с субдомена, рекомендуется установить «домен cookie». При этом файлы cookie не будут отправляться каждый раз, когда запрашивается статическое содержимое.

```
define('COOKIE_DOMAIN', 'www.yourwebsite.com');
```

 > **Быстрый совет**  Чтобы обслуживать загруженные вами мультимедиа из субдомена, просто укажите в двух последних текстовых полях на странице «Параметры мультимедиа» путь `(например /home/myblog/public_html/mysubdomain)` и URL-адрес (`например https://mysubdomain.myblog.com/) вашего субдомена.


## Скорость: изменить метод файловой системы
Если вы часто устанавливаете, обновляете или удаляете свои плагины и темы, скорее всего, вы ненавидите вводить свой FTP-пароль каждый раз, когда имеете дело с ними. Приведенный ниже код облегчает вам задачу, заставляя файловую систему использовать прямой запрос файлового ввода-вывода из PHP — другими словами, вам больше не нужно будет вводить учетные данные FTP.

```
define('FS_METHOD', 'direct');
```

 > Обратите внимание, что это может работать не с каждым хостинг-провайдером, и даже если оно работает, это может вызвать проблемы с безопасностью на плохо настроенных хостах. Поэтому убедитесь, что вы используете его на приличном сервере.


## Безопасность: ограничить доступ к файлу wp-config.php

Этот совет требует от вас редактирования файла `.htaccess` в корневом каталоге, а не файла `wp-config.php` . 
Это в основном предотвращает загрузку злонамеренными людьми `yourblog.com/wp-config.php` напрямую через браузер:

```
# protect wpconfig.php
<files wp-config.php>
    order allow,deny
    deny from all
</files>
```


Просто добавьте это в свой файл `.htaccess` , и все готово!


## Безопасность: Принудительно использовать SSL в панели администратора

Включен ли SSL на вашем сервере? Большой! Вы можете заставить WordPress использовать безопасное соединение при входе в систему с помощью этой строки кода:
```
define('FORCE_SSL_LOGIN', true);
```



И если вы слишком параноидально относитесь к безопасности (что на самом деле хорошо), вы можете заставить WordPress использовать SSL на каждой странице администрирования, чтобы все, что вы там делаете, выполнялось с зашифрованным соединением:
```
define('FORCE_SSL_ADMIN', true);
```

 > Дополнительную информацию о настройке SSL можно найти в Кодексе WordPress на странице « Администрирование через SSL ».


## Безопасность: изменение префикса базы данных
Если бы в WordPress была уязвимость в системе безопасности, которая позволяла бы злонамеренным людям использовать метод взлома, известный как « инъекция SQL », они бы легко использовали префиксы по умолчанию в таблицах базы данных WordPress для их удаления. Однако, если у вас префикс таблицы отличается от префикса по умолчанию ( `wp_`), они не смогут догадаться об этом, не так ли?

Итак, при настройке нового веб-сайта WordPress либо измените значение по умолчанию на странице установки, либо в файле `wp-config.php` измените строку ниже:

```
$table_prefix  = 'wooh00yeah_';
```

 > Осторожно: если вы хотите, чтобы это работало на существующем сайте WordPress, вы не можете просто изменить префикс в файле wp-config.php — вы получите ошибки подключения к базе данных. Вы должны использовать плагин для этого, чтобы изменить файл wp-config.php И таблицы базы данных И некоторые конкретные значения внутри этих таблиц. Я рекомендую плагин `DB Prefix Change` .

Advertisement



## Безопасность: добавьте ключи безопасности... сейчас!

Давайте просто прочитаем из Кодекса WordPress :
 > Проще говоря, секретный ключ — это пароль с элементами, которые усложняют создание достаточного количества вариантов для преодоления ваших барьеров безопасности. Пароль типа «пароль» или «тест» прост и легко взламывается. Случайный, непредсказуемый пароль, такой как «88a7da62429ba6ad3cb3c76a09641fc», занимает годы, чтобы подобрать правильную комбинацию. Соль используется для дальнейшего повышения безопасности сгенерированного результата.

Это одна из самых важных мер безопасности для WordPress — и ее легко выполнить, просто скопировав и вставив случайно сгенерированное содержимое этой страницы в ваш файл `wp-config.php` . Самое сложное — найти пустые значения этих констант по умолчанию и удалить их! :)



## Другое: изменение интервала автосохранения
Если вы иногда работаете над своим постом в течение 4 часов, вас может раздражать, что WordPress автоматически сохраняет состояние вашего поста каждые 60 секунд. Я отдам должное, что это неплохо, но иногда это очень, очень раздражает. В любом случае, если вы хотите установить более высокое значение интервала автосохранения, вы можете сделать это, определив его в файле `wp-config.php` следующим образом:

```
define('AUTOSAVE_INTERVAL', 240 );     // the value should be in seconds!
```


## Другое: легко перемещайте свой сайт WordPress
WordPress полон сюрпризов, и это один из них. Если вам когда-нибудь понадобится переместить свой веб-сайт на новый домен (или новый поддомен, или новую папку), определите эту константу в файле `wp-config.php` перед перемещением файлов и базы данных:
```
define('RELOCATE',true);      // We're not done yet!
```
После установки этого параметра и перемещения вашего FTP и базы данных войдите в систему с вашими учетными данными WP на `yournewwebsite.com/login.php` и после этого проверьте, не изменился ли домашний URL-адрес на странице «Общие параметры». Убедившись, что он изменился, удалите константу в файле wp-config.php . Этот маленький трюк WordPress избавляет вас от необходимости редактировать базу данных вручную.

 > Совет. Хотя это буквально «перемещает» ваш веб-сайт, это не влияет на жестко закодированные ссылки в вашем контенте. Чтобы заменить их, вы должны использовать плагин, такой как Search Regex , и заменить старые ссылки на новые.


## Другое: отключить редактирование файлов плагинов и тем
Если вы веб-дизайнер и используете WordPress на веб-сайтах своих клиентов, вы можете отключить редактирование файлов тем и плагинов, добавив следующую константу:
```
define('DISALLOW_FILE_EDIT',true);
```


Более того, вы также можете отключить установку новых тем и плагинов и их обновление:
```
define('DISALLOW_FILE_MODS',true);
```

Просто помните, что обновления тем и плагинов иногда очень важны, когда они устраняют недостатки безопасности. Поэтому, если вы собираетесь отключить обновление и установку новых плагинов/тем, вам придется отслеживать обновления другим способом.



## Другое: включить WP_DEBUG во время разработки
Это просто: если вы разрабатываете плагин или тему, рекомендуется включить функцию отладки WordPress, чтобы увидеть, какие уведомления и предупреждения вы получаете:
```
define('WP_DEBUG',true);
```



_________________________________________________

## 1. Установка темы по умолчанию для новых установок WordPress с помощью WP_DEFAULT_THEME
Допустим, вы внештатный веб-дизайнер (или агентство веб-дизайна), которое использует базовую тему WordPress почти для каждого своего клиента. 
Было бы здорово, если бы вам не приходилось менять тему с «Twenty-Something» на «Awesome Base Theme» каждый раз, когда вы создаете новую установку WordPress?

WP_DEFAULT_THEME константа вас охватила:

```
<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">определить('WP_DEFAULT_THEME', 'имя-папки-темы-по-умолчанию');</font></font>
```

 > Вы можете спросить: «Как я должен установить тему по умолчанию, отредактировав wp-config.php файл, когда этот файл создается при установке WordPress?» 
 > Отличный вопрос, но на этот раз мы не будем изменять `wp-config.php` файл: вместо этого мы собираемся вставить в `wp-config-sample.php` файл приведенный выше код!

Я не говорю о редактировании и переименовании файла, как в 2006 году, я говорю о редактировании файла и оставлении его таким: WordPress может обнаруживать изменения и дополнения внутри `wp-config-sample.php` файла (кроме учетных данных базы данных) и использовать их при установке. ваша свежая копия WordPress.

Аккуратно, верно? Я не нашел ни одной веб-страницы, в которой упоминалась бы эта скрытая жемчужина (и я нашел эту технику случайно), так что это руководство может быть первым разом, когда эта функция рассматривается.



## 2. Отключение функции автоматического обновления WordPress с помощью `AUTOMATIC_UPDATER_DISABLED`
У вас могут быть свои причины не позволять WordPress обновлять себя: может быть, вы разработчик, которому необходимо работать со многими версиями WordPress одновременно, или ваш веб-сайт находится на крайне нестабильном сервере, что требует от вас чрезвычайной осторожности.

В любом случае, мы здесь, чтобы предложить вам решение по отключению автоматических обновлений для WordPress:

```
define( 'AUTOMATIC_UPDATER_DISABLED', true );
```


##  3. Включение функции «Корзина» для медиафайлов с MEDIA_TRASH
Вы когда-нибудь кричали пронзительным голосом и ругались в течение семи минут подряд после удаления медиафайла, когда вы не должны были его удалять? Я знаю, что знал, прежде чем выучил эту константу WordPress:
```
define( 'MEDIA_TRASH', true );
```

Установите его, и вам никогда не придется беспокоиться об удалении медиафайла, за исключением случаев, когда вы полностью отключили функцию «корзины» WordPress, установив для `EMPTY_TRASH_DAYS` константы значение «0».



## 4. Разрешение WordPress пропускать каталог wp-content при обновлении с помощью `CORE_UPGRADE_SKIP_NEW_BUNDLED`
Я не использую темы по умолчанию. Всегда. Я не против них и не люблю их, но я предпочитаю создавать и использовать свои собственные темы. Таким образом, мне не нужна новая тема по умолчанию при установке крупного обновления.

Поскольку WordPress настолько гибок, и я не уникален в этом, он дает нам возможность пропустить обновление `wp-content` каталога:

```
define( 'CORE_UPGRADE_SKIP_NEW_BUNDLED', true );
```
 > Это также может немного увеличить скорость процесса обновления. Однако не ждите больше секунды.



## 5. Разрешение нефильтрованных загрузок WordPress для администраторов с помощью ALLOW_UNFILTERED_UPLOADS
WordPress имеет ограничения по типам файлов при загрузке файлов в медиатеку. Вы не можете загружать ничего, кроме изображений, документов, аудио- или видеофайлов — и это хорошо для безопасности. Но что, если вы независимый разработчик программного обеспечения и хотите загружать новые выпуски своего программного обеспечения — придется ли вам использовать FTP-клиент каждый раз, когда вы обновляете свое программное обеспечение?

Нет, вам просто нужно определить `ALLOW_UNFILTERED_UPLOADS`, `ALLOW_UNFILTERED_UPLOADS` как это:

```
define( 'ALLOW_UNFILTERED_UPLOADS', true );
```

 > Однако этот код не позволяет каждому пользователю загружать файлы всех типов. Только администраторы могут загружать все, что хотят.


## 6. Динамическая настройка WPLANG на многоязычных веб-сайтах

Если у вас есть многоязычный веб-сайт и вам нужно, чтобы ваш веб-сайт изменил язык вашей темы и панели администрирования, вы можете сделать небольшой трюк, чтобы определить язык браузера посетителя и определить `WPLANG` константу на основе этой информации.

Сначала вам нужно создать `wp-lang.php` файл и заполнить его приведенным ниже кодом, затем сохранить его в той же директории `wp-config.php` , что и в:

```
<?php <font></font>
// start the session <font></font>
session_start(); <font></font>
<font></font>
// if there's a "lang" parameter in the URL...  <font></font>
if( isset( $_GET[ 'lang' ] ) ) { <font></font>
<font></font>
    // ...set a session variable named WPLANG based on the URL parameter...     <font></font>
    $_SESSION[ 'WPLANG' ] = $_GET[ 'lang' ]; <font></font>
<font></font>
    // ...and define the WPLANG constant with the WPLANG session variable <font></font>
    define( 'WPLANG', $_SESSION[ 'WPLANG' ] ); <font></font>
<font></font>
// if there isn't a "lang" parameter in the URL...  <font></font>
} else {<font></font>
<font></font>
    // if the WPLANG session variable is already set...<font></font>
    if( isset( $_SESSION[ 'WPLANG' ] ) ) {<font></font>
<font></font>
        // ...define the WPLANG constant with the WPLANG session variable <font></font>
        define( 'WPLANG', $_SESSION[ 'WPLANG' ] );  <font></font>
<font></font>
    // if the WPLANG session variable isn't set...<font></font>
    } else { <font></font>
        <font></font>
        // set the WPLANG constant to your default language code is (or empty, if you don't need it)        <font></font>
        define( 'WPLANG', 'tr_TR' ); <font></font>
            <font></font>
    } <font></font>
} <font></font>
?>
```

 Затем в wp-config.phpфайле замените строку, где WPLANGопределено, на строку ниже:

```
require_once( dirname( __FILE__ ) . '/wp-lang.php' );
```

 > Теперь ваши посетители могут изменить язык вашей темы и панели администратора простым нажатием кнопок с lang=fr_FRпараметром URL.




## 7. Определение ключа API WordPress.com как константы с помощью WPCOM_API_KEY
Если вы используете плагин, для которого требуется ключ API WordPress.com (например, Jetpack или Akismet ), и вам нужно поддерживать множество веб-сайтов WordPress, может быть немного раздражающим ввод ключа API WordPress.com каждый раз при установке этого плагина. плагин.

Однако есть простой способ. Вы можете определить свой `key API` в `wp-config.php` файле как константу:

```
define( 'WPCOM_API_KEY', 'YourKeyHere' );
```

 > Проверьте, есть ли у других ваших любимых плагинов эта функция. Такие плагины, как SlideDeck и Gravity Forms, также поддерживают определение своих ключей API как константу.




## 8. Переопределение разрешенных тегов HTML с нуля с помощью CUSTOM_TAGS
В WordPress есть функция `wp_kses()` , которая, согласно Кодексу WordPress:

 > «... гарантирует, что в $string будут встречаться только разрешенные имена элементов HTML, имена атрибутов и значения атрибутов, а также только разумные объекты HTML».

Вы можете редактировать его правила с помощью фильтров, например:

```
<?php <font></font>
<font></font>
function my_filter( $string ) {<font></font>
<font></font>
    global $allowedtags;<font></font>
    $allowedtags['img'] = array( 'src' => array () );<font></font>
<font></font>
    return $string;<font></font>
}<font></font>
add_filter( 'pre_kses', 'my_filter' );<font></font>
?>
```

> Но если вам нужен **полный контроль** , что означает переписывание `$allowedposttags` переменных `$allowedtags` и `$allowedentitynames` , вы можете сделать это, определив `CUSTOM_TAGS` константу в `true in wp-config.php` :

```
define( 'CUSTOM_TAGS', true );<font></font>
$allowedposttags = array();<font></font>
$allowedtags = array();<font></font>
$allowedentitynames = array();
```

Вы должны  переписать каждую переменную ниже, просто скопировать и вставить переменные в `wp-includes/kses.php`, а затем отредактировать вставленный код.

